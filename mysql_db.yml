---
- name: Laravel Deployment Using Ansible
  hosts: node
  remote_user: ubuntu
  become: true

  tasks:
  - name: Install Python3
    apt: name=python3 state=latest

  - name: Install Pip
    apt: name=pip state=latest

  - name: Install MySQL Server
    apt:
     name: mysql-server
     state: latest

  - name: Install MySQL Client
    apt:
     name: mysql-client
     state: latest

  - name: Install PyMySQL Library
     pip:
     name: pymysql
     state: latest

  - name: Start mySQL
    service:
      name: mysql
      enabled: true
      state: started

  - name: Create ~/.my.cnf
    file:
      path: ~/.my.cnf
      state: touch

  - name: Insert into ~/.my.cnf
    blockinfile:
      path: ~/.my.cnf
      block: |
        [client]
        user={{ mysql_user }}
        password={{ mysql_app_pass }}
  
  - name: sql query flush
    command:  mysql -u root --execute="FLUSH PRIVILEGES"

  - name: Create a Database
    mysql_db:
      login_user: 'root'
      login_password: "{{ mysql_app_pass }}"
      name: "{{ mysql_app_db }}"
      state: present

  - name: Restart MySQL
    service: name=mysql state=restarted

  - name: Copy the PostgreSQL Script
      copy:
      src: exam.sh
      dest: /home/ubuntu
      mode: '0775'
      owner: ubuntu
      group: ubuntu
  
  - name: Execute the PostgreSQL Script
    command: sh /home/ubuntu/script.sh